{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/zod_schema/utils.ts","src://tavern_helper_template/src/zod_schema/schema.ts","src://tavern_helper_template/src/zod_schema/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","/**\n * 布尔值转换\n */\nexport const coercedBoolean = (defaultVal = false) => z\n    .preprocess(val => (typeof val === 'string' ? val === '是' : val), z.boolean())\n    .prefault(defaultVal);\n/** 数值范围限制 */\nexport const clamp = (min, max) => (val) => _.clamp(val, min, max);\n/**\n * 范围限制数值 schema\n */\nexport const clampedNum = (defaultVal, min, max) => z.coerce.number().prefault(defaultVal).transform(clamp(min, max));\n// 基础物品描述 schema\nexport const BaseItemSchema = z.object({\n    品质: z.string(),\n    标签: z.string(),\n    效果: z.string(),\n    描述: z.string(),\n});\n// 技能 schema (扩展基础物品 + 类型/消耗)\nexport const SkillSchema = BaseItemSchema.extend({\n    类型: z.string(),\n    消耗: z.string(),\n}).transform(({ 品质, 类型, 消耗, 标签, 效果, 描述 }) => ({\n    品质,\n    类型,\n    消耗,\n    标签,\n    效果,\n    描述,\n}));\n// 装备 schema (扩展基础物品 + 位置)\nexport const EquipmentSchema = BaseItemSchema.extend({\n    位置: z.string(),\n});\n// 命定之人装备 schema (扩展基础物品 + 类型)\nexport const DestinedEquipmentSchema = BaseItemSchema.extend({\n    类型: z.string(),\n}).transform(({ 品质, 类型, 标签, 效果, 描述 }) => ({\n    品质,\n    类型,\n    标签,\n    效果,\n    描述,\n}));\n// 背包物品 schema (扩展命定装备 + 数量)\nexport const InventoryItemSchema = BaseItemSchema.extend({\n    数量: z.coerce.number().prefault(1),\n    类型: z.string(),\n}).transform(({ 品质, 数量, 类型, 标签, 效果, 描述 }) => ({\n    品质,\n    数量,\n    类型,\n    标签,\n    效果,\n    描述,\n}));\n// 基础属性 schema\nexport const BaseAttributeSchema = z.object({\n    力量: z.coerce.number(),\n    敏捷: z.coerce.number(),\n    体质: z.coerce.number(),\n    智力: z.coerce.number(),\n    精神: z.coerce.number(),\n});\n// 角色属性 schema (扩展基础属性 + 属性点)\nexport const CharacterAttributeSchema = BaseAttributeSchema.extend({\n    属性点: z.coerce.number(),\n});\n// 神国 schema\nexport const DivineRealmSchema = z.object({\n    名称: z.string().prefault(''),\n    描述: z.string().prefault(''),\n});\n/** 截取 record 的前 n 个条目 */\nconst sliceRecord = (record, limit) => Object.fromEntries(Object.entries(record).slice(0, limit));\n// 登神长阶 schema\n// 要素限3个，权能限1个，法则限1个，神位不为空时，法则无上限\nexport const AscensionSchema = z\n    .object({\n    是否开启: coercedBoolean(false),\n    要素: z.record(z.string(), z.string()).prefault({}),\n    权能: z.record(z.string(), z.string()).prefault({}),\n    法则: z.record(z.string(), z.string()).prefault({}),\n    神位: z.string().prefault(''),\n    神国: DivineRealmSchema.prefault({}),\n})\n    .transform(data => ({\n    ...data,\n    要素: sliceRecord(data.要素, 3),\n    权能: sliceRecord(data.权能, 1),\n    法则: data.神位 ? data.法则 : sliceRecord(data.法则, 1),\n}));\n// 任务 schema\nexport const QuestSchema = z.object({\n    简介: z.string(),\n    目标: z.string(),\n    奖励: z.string(),\n});\n","import { AscensionSchema, BaseAttributeSchema, CharacterAttributeSchema, clampedNum, coercedBoolean, DestinedEquipmentSchema, EquipmentSchema, InventoryItemSchema, QuestSchema, SkillSchema, } from './utils.ts';\nexport const Schema = z.object({\n    世界: z.object({\n        时间: z.string(),\n        地点: z.string(),\n    }),\n    事件链: z.object({\n        开启: z.boolean().prefault(false),\n        结束: z.boolean().prefault(false),\n        琥珀事件: z.boolean().prefault(false),\n        标题: z.any(),\n        阶段: z.any(),\n        已完成事件: z.array(z.any()),\n    }),\n    任务列表: z.record(z.string(), QuestSchema),\n    角色: z\n        .object({\n        种族: z.string(),\n        身份: z.array(z.string()),\n        职业: z.array(z.string()),\n        生命层级: z.string().prefault('第一层级/普通层级'),\n        等级: clampedNum(1, 1, 25),\n        累计经验值: z.coerce.number(),\n        升级所需经验: z.coerce.number().prefault(23),\n        冒险者等级: z.string().prefault('未评级'),\n        生命值上限: z.coerce.number(),\n        生命值: z.coerce.number(),\n        法力值上限: z.coerce.number(),\n        法力值: z.coerce.number(),\n        体力值上限: z.coerce.number(),\n        体力值: z.coerce.number(),\n        属性: CharacterAttributeSchema,\n        技能列表: z.record(z.string(), SkillSchema),\n    })\n        .transform(data => ({\n        ...data,\n        升级所需经验: data.等级 >= 25 ? 'MAX' : data.升级所需经验,\n        生命值: _.clamp(data.生命值, 0, data.生命值上限),\n        法力值: _.clamp(data.法力值, 0, data.法力值上限),\n        体力值: _.clamp(data.体力值, 0, data.体力值上限),\n    })),\n    背包: z\n        .record(z.string(), InventoryItemSchema)\n        .transform(items => Object.fromEntries(Object.entries(items).filter(([, item]) => item.数量 > 0))),\n    货币: z.object({\n        金币: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(Math.max(val, 0))),\n        银币: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(Math.max(val, 0))),\n        铜币: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(val)),\n    }),\n    装备: z.object({\n        武器: z.record(z.string(), EquipmentSchema),\n        防具: z.record(z.string(), EquipmentSchema),\n        饰品: z.record(z.string(), EquipmentSchema),\n    }),\n    登神长阶: AscensionSchema,\n    命定系统: z.object({\n        命运点数: z.coerce.number().transform(val => Math.floor(Math.max(val, 0))),\n        命定之人: z.record(z.string(), z.object({\n            是否在场: coercedBoolean(true),\n            生命层级: z.string(),\n            等级: clampedNum(1, 1, 25),\n            种族: z.string(),\n            身份: z.array(z.string()),\n            职业: z.array(z.string()),\n            性格: z.string(),\n            喜爱: z.string(),\n            外貌特质: z.string(),\n            衣物装饰: z.string(),\n            装备: z.record(z.string(), DestinedEquipmentSchema),\n            属性: BaseAttributeSchema,\n            登神长阶: AscensionSchema,\n            是否缔结契约: coercedBoolean(false),\n            好感度: clampedNum(0, -100, 100),\n            评价: z.string(),\n            背景故事: z.string(),\n            技能: z.record(z.string(), SkillSchema),\n        })),\n    }),\n    新闻: z.object({\n        阿斯塔利亚快讯: z.object({\n            势力要闻: z.string(),\n            尊位行迹: z.string(),\n            军事行动: z.string(),\n            经济动脉: z.string(),\n            灾害预警: z.string(),\n        }),\n        酒馆留言板: z.object({\n            高额悬赏: z.string(),\n            冒险发现: z.string(),\n            怪物异动: z.string(),\n            通缉要犯: z.string(),\n            宝物传闻: z.string(),\n        }),\n        午后茶会: z.object({\n            社交逸闻: z.string(),\n            千里远望: z.string(),\n            命运涟漪: z.string(),\n            邂逅预兆: z.string(),\n        }),\n    }),\n});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\n\nimport { Schema } from './schema.ts';\n\n$(() => {\n  registerMvuSchema(Schema);\n});\n"],"names":["z","coercedBoolean","defaultVal","preprocess","val","boolean","prefault","clampedNum","min","max","coerce","number","transform","_","clamp","BaseItemSchema","object","string","SkillSchema","extend","EquipmentSchema","DestinedEquipmentSchema","InventoryItemSchema","BaseAttributeSchema","CharacterAttributeSchema","DivineRealmSchema","sliceRecord","record","limit","Object","fromEntries","entries","slice","AscensionSchema","data","QuestSchema","Schema","any","array","items","filter","item","Math","floor","$"],"ignoreList":[],"sourceRoot":""}